<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khu V∆∞·ªùn Tri Th·ª©c Hi·ªán ƒê·∫°i</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* B·∫£ng m√†u V∆∞·ªùn hoa Hi·ªán ƒë·∫°i (Tulip & H∆∞·ªõng d∆∞∆°ng) */
            --sunflower-yellow: #F59E0B; 
            --sunflower-orange: #D97706; 
            --tulip-pink: #EC4899; 
            --tulip-red: #BE185D; 
            
            --leaf-sage: #84CC16; 
            --leaf-deep: #3F6212; 
            
            --bg-cream: #FFFBEB; 
            --text-dark: #1F2937; 
            --text-muted: #6B7280;
            
            --font-heading: 'Poppins', sans-serif;
            --font-body: 'Nunito', sans-serif;

            --radius-md: 16px;
            --radius-lg: 24px;
            --shadow-soft: 0 10px 25px -5px rgba(0, 0, 0, 0.08), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
            --shadow-hover: 0 20px 35px -5px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-cream);
            background-image: 
                radial-gradient(circle at 15% 20%, rgba(245, 158, 11, 0.08) 0%, transparent 25%), 
                radial-gradient(circle at 85% 80%, rgba(236, 72, 153, 0.08) 0%, transparent 25%); 
            color: var(--text-dark);
            line-height: 1.6;
            padding: 40px 15px;
            margin: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #FFFFFF;
            padding: 40px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            position: relative;
            overflow: hidden;
            border-top: 5px solid var(--sunflower-yellow);
        }

        h1 {
            text-align: center;
            font-family: var(--font-heading);
            color: var(--leaf-deep);
            font-weight: 800;
            font-size: 2.2em;
            margin-bottom: 35px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        h1::before { content: 'üåª'; font-size: 1.2em; }
        h1::after { content: 'üå∑'; font-size: 1.2em; }

        .student-info-card {
            background-color: #F0FDF4; 
            padding: 25px;
            border-radius: var(--radius-md);
            margin-bottom: 40px;
            border: 1px solid #BBF7D0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }

        .student-info-card h3 {
            margin-top: 0;
            font-family: var(--font-heading);
            color: var(--leaf-deep);
            font-size: 1.3em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        .student-info-card h3::before { content: 'üå±'; margin-right: 10px; }

        .input-group label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--leaf-deep);
        }

        .input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 1.05em;
            font-family: var(--font-body);
            box-sizing: border-box;
            outline: none;
            background: #FFFFFF;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            border-color: var(--leaf-sage);
            box-shadow: 0 0 0 4px rgba(132, 204, 22, 0.15);
        }

        .question-card {
            background: #FFFFFF;
            margin-bottom: 30px;
            padding: 30px;
            border-radius: var(--radius-md);
            border: 1px solid #F3F4F6;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .question-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
            border-color: var(--sunflower-yellow);
        }

        .question-title {
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 1.2em;
            margin-bottom: 20px;
            color: var(--leaf-deep);
        }

        .poem-text {
            font-family: var(--font-body);
            font-size: 1.1em;
            font-style: italic;
            background-color: #FFFBEB; 
            padding: 20px;
            border-radius: var(--radius-md);
            border-left: 4px solid var(--sunflower-yellow);
            margin: 15px 0;
            color: #78350F;
        }

        .image-placeholder {
            width: 100%;
            border-radius: var(--radius-md);
            overflow: hidden;
            margin-bottom: 20px;
            text-align: center;
            background-color: #F9FAFB;
            padding: 10px;
            border: 1px solid #E5E7EB;
        }
        
        .image-placeholder img {
            max-width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
            margin: 0 auto;
        }

        .options-list {
            list-style-type: none;
            padding: 0;
            display: grid;
            gap: 12px;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            background-color: #FFFFFF;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            color: var(--text-dark);
        }

        .option-label:hover {
            background-color: #FFF7ED; 
            border-color: var(--sunflower-yellow);
            transform: translateX(5px);
        }
        
        input[type="radio"]:checked + span {
             color: var(--tulip-red);
        }
        
        .option-label:has(input[type="radio"]:checked) {
            background-color: #FDF2F8; 
            border-color: var(--tulip-pink);
        }

        input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.3);
            accent-color: var(--tulip-pink);
            cursor: pointer;
        }

        .arrange-container {
            margin-top: 20px;
            background: #F9FAFB;
            padding: 25px;
            border-radius: var(--radius-md);
            border: 1px solid #E5E7EB;
        }
        
        .arrange-label {
            font-family: var(--font-heading);
            font-weight: 700;
            color: var(--leaf-deep);
            margin-bottom: 12px;
            display: block;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .letters-pool, .answer-box {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding: 16px;
            min-height: 65px;
            border-radius: 12px;
            margin-bottom: 20px;
            align-items: center;
        }

        .letters-pool {
            background-color: #FFFFFF;
            border: 2px dashed var(--leaf-sage);
        }

        .answer-box {
            background-color: #FFFFFF;
            border: 2px solid var(--sunflower-orange);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .letter-tile {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            background: #FFFFFF;
            color: var(--leaf-deep);
            font-size: 1.5em;
            font-family: var(--font-heading);
            font-weight: 700;
            border: 2px solid var(--leaf-sage);
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.08);
            user-select: none;
            transition: all 0.2s;
        }

        .letter-tile:hover {
            transform: translateY(-3px);
            border-color: var(--sunflower-yellow);
            color: var(--sunflower-orange);
        }

        .letter-tile:active {
            transform: scale(0.95);
        }

        .correct-text-msg {
            color: var(--leaf-deep);
            font-weight: 700;
            margin-top: 15px;
            display: none;
            font-size: 1.1em;
        }
        .correct-text-msg::before { content: 'üå∑ ƒê√°p √°n ƒë√∫ng: '; color: var(--tulip-pink); }

        .correct-answer {
            background-color: #DCFCE7 !important; 
            border-color: #22C55E !important;
            color: #15803D !important;
        }
        
        .wrong-answer {
            background-color: #FEE2E2 !important; 
            border-color: #EF4444 !important;
            color: #B91C1C !important;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            font-size: 1.2em;
            font-family: var(--font-heading);
            font-weight: 700;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 40px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: var(--shadow-soft);
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--sunflower-yellow), var(--sunflower-orange));
        }

        .submit-btn:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .reset-btn {
            background: linear-gradient(135deg, var(--tulip-pink), var(--tulip-red));
            display: none; 
        }

        .reset-btn:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }
        
        .loading {
            opacity: 0.8;
            pointer-events: none;
            background: #9CA3AF !important;
        }

        #result-box {
            display: none;
            margin-top: 50px;
            padding: 35px;
            background-color: #FFFFFF;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-hover);
            border-top: 5px solid var(--tulip-pink);
            text-align: center;
        }

        #result-box h2 {
            margin-top: 0;
            font-family: var(--font-heading);
            color: var(--tulip-red);
            font-size: 2em;
            font-weight: 800;
            margin-bottom: 25px;
        }

        .result-stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
            text-align: left;
        }

        .result-stat {
            font-size: 1.1em;
            padding: 15px;
            background: #F9FAFB;
            border-radius: 12px;
            font-weight: 600;
            color: var(--text-dark);
            border: 1px solid #E5E7EB;
        }
        
        .result-stat span {
            display: block;
            font-size: 0.9em;
            color: var(--text-muted);
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .score-highlight {
            color: var(--tulip-pink);
            font-weight: 800;
            font-size: 1.3em;
        }

        @media (max-width: 600px) {
            body { padding: 20px 10px; }
            .container { padding: 25px 20px; }
            h1 { font-size: 1.8em; flex-direction: column; gap: 10px; }
            h1::before, h1::after { display: none; } 
            .btn { font-size: 1.1em; padding: 14px; }
            .result-stats-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>√în T·∫≠p Ki·∫øn Th·ª©c</h1>

    <div class="student-info-card">
        <h3>Th√¥ng tin h·ªçc sinh</h3>
        <div class="input-group">
            <label for="studentName">H·ªç v√† t√™n c·ªßa em:</label>
            <input type="text" id="studentName" placeholder="Nh·∫≠p h·ªç v√† t√™n..." required>
        </div>
        <div class="input-group">
            <label for="studentClass">L·ªõp:</label>
            <input type="text" id="studentClass" placeholder="Nh·∫≠p t√™n l·ªõp..." required>
        </div>
    </div>

    <div id="quiz-container"></div>
    
    <button id="submitBtn" class="btn submit-btn" onclick="submitQuiz()">N·ªôp B√†i & Ch·∫•m ƒêi·ªÉm</button>
    <button id="resetBtn" class="btn reset-btn" onclick="resetQuiz()">L√†m L·∫°i B√†i (ƒê·∫£o C√¢u H·ªèi)</button>
    
    <div id="result-box"></div>
</div>

<script>
    // ‚úÖ URL G·ª≠i ƒëi·ªÉm tr·ª±c ti·∫øp v·ªÅ Google Sheets c·ªßa b·∫°n
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxRA-yjp6i3c1FkUygNdWfGifXgLOV6UAPp3fB4MjjTZCvKLakwUcSJTrrrCWDpSgcD/exec'; 

    const quizData = [
        {
            id: 1, type: "multiple",
            text: "Nh·ªØng chi·∫øn sƒ© b·∫£o v·ªá t·ªï qu·ªëc c√≤n ƒë∆∞·ª£c g·ªçi l√† g√¨?",
            options: ["A. gi√°o vi√™n", "B. kƒ© s∆∞", "C. b·ªô ƒë·ªôi", "D. c·∫ßu th·ªß"],
            answer: 2
        },
        {
            id: 2, type: "multiple",
            text: "ƒê√°p √°n n√†o d∆∞·ªõi ƒë√¢y ch·ªâ g·ªìm c√°c t·ª´ ng·ªØ ch·ªâ trang ph·ª•c?",
            options: [
                "A. ƒë√¥i d√©p, th·∫Øt l∆∞ng, b√≥ hoa", 
                "B. qu·∫ßn v·∫£i, ƒë√¥i gi√†y, trang tr√≠", 
                "C. √°o kho√°c, m≈© len, khƒÉn qu√†ng", 
                "D. ƒë√¥i t·∫•t, gƒÉng tay, ph·ª•c v·ª•"
            ],
            answer: 2
        },
        {
            id: 3, type: "multiple",
            text: "Kh·ªï th∆° d∆∞·ªõi ƒë√¢y nh·∫Øc ƒë·∫øn d·∫•u thanh n√†o?<br><div class='poem-text'>D·∫•u n√†o c≈©ng n·ªïi tr√™n<br>Ri√™ng em th√¨ ch√¨m d∆∞·ªõi<br>M·ªçi ng∆∞·ªùi ƒë·ª´ng ch√™ em<br>Tuy nh·ªè nh∆∞ng n·∫∑ng k√≠.</div>(Nguy·ªÖn L√£m Th·∫Øng)",
            options: ["A. d·∫•u huy·ªÅn", "B. d·∫•u ng√£", "C. d·∫•u n·∫∑ng", "D. d·∫•u h·ªèi"],
            answer: 2
        },
        {
            id: 4, type: "multiple",
            text: "\"T√™ gi√°c\" c√≥ th·ªÉ gh√©p v·ªõi ƒë√°p √°n n√†o ƒë·ªÉ t·∫°o th√†nh c√¢u ƒë√∫ng?",
            options: [
                "A. nh·∫∑t th√≥c tr√™n s√¢n", 
                "B. s·ªëng trong khu r·ª´ng", 
                "C. ·∫•p tr·ª©ng trong t·ªï", 
                "D. m√≤ c√° tr√™n ƒë·ªìng"
            ],
            answer: 1
        },
        {
            id: 5, type: "multiple",
            imageText: "<img src='image/cau5.jpg' alt='H√¨nh ·∫£nh ƒë√†n ong' style='max-width: 100%; height: auto;'>",
            text: "C√¢u n√†o m√¥ t·∫£ ƒë√∫ng h√¨nh ·∫£nh sau?",
            options: [
                "A. Nh·ªØng ch√∫ ong chƒÉm ch·ªâ t√¨m m·∫≠t trong v∆∞·ªùn.", 
                "B. Nh·ªØng ch√∫ b∆∞·ªõm ƒëang h√∫t m·∫≠t trong v∆∞·ªùn.", 
                "C. Nh·ªØng ch√∫ chim ƒëang ki·∫øm ƒÉn trong v∆∞·ªùn.", 
                "D. Nh·ªØng ch√∫ ong v√†ng ƒëang l√†m t·ªï trong v∆∞·ªùn."
            ],
            answer: 0
        },
        {
            id: 6, type: "multiple",
            text: "Ch·ªçn v·∫ßn th√≠ch h·ª£p ƒëi·ªÅn v√†o ch·ªó tr·ªëng.<br>C√°c t·ª´ ng·ªØ \"bi·∫øt ∆°n\", \"ti·∫øt h·ªçc\", \"th√¢n thi·∫øt\", \"vi·∫øt ch·ªØ\" c√≥ chung v·∫ßn .....",
            options: ["A. i√™n", "B. i√™t", "C. i√™c"],
            answer: 1
        },
        {
            id: 7, type: "multiple",
            text: "L·ªõp 1B c√≥ m·ªôt b·∫°n h·ªçc sinh m·ªõi chuy·ªÉn ƒë·∫øn. B·∫°n ·∫•y c√≥ v·∫ª nh√∫t nh√°t v√† ch∆∞a quen ai. C√¥ gi√°o nh·ªù l·ªõp tr∆∞·ªüng ra l√†m quen v·ªõi b·∫°n. B·∫°n l·ªõp tr∆∞·ªüng n√™n n√≥i g√¨?",
            options: [
                "A. Ch√†o c·∫≠u, t·ªõ l√† l·ªõp tr∆∞·ªüng. R·∫•t vui ƒë∆∞·ª£c l√†m quen v·ªõi c·∫≠u. C·∫≠u c√≥ c·∫ßn t·ªõ gi√∫p g√¨ kh√¥ng?", 
                "B. T·∫°i sao c·∫≠u l·∫°i chuy·ªÉn ƒë·∫øn tr∆∞·ªùng n√†y v·∫≠y?", 
                "C. Nh√¨n c·∫≠u c√≥ v·∫ª √≠t n√≥i nh·ªâ.", 
                "D. C·∫≠u c√≥ bi·∫øt l√†m b√†i t·∫≠p to√°n h√¥m qua kh√¥ng?"
            ],
            answer: 0
        },
        {
            id: 8, type: "multiple",
            imageText: "<img src='image/cau8.jpg' alt='H√¨nh ·∫£nh c√°c con v·∫≠t' style='max-width: 100%; height: auto;'>",
            text: "Trong h√¨nh ·∫£nh tr√™n c√≥ ...... con v·∫≠t c√≥ t√™n ch·ª©a v·∫ßn \"√¢u\"?",
            options: ["A. 1", "B. 2", "C. 3", "D. 4"],
            answer: 1
        },
        {
            id: 9, type: "multiple",
            text: "Ch·ªçn ch·ªØ th√≠ch h·ª£p l·∫ßn l∆∞·ª£t ƒëi·ªÅn v√†o ch·ªó tr·ªëng sau:<br>Th·ªùi ti·∫øt m√πa ƒë√¥ng [...]·∫•t l·∫°nh [...]√°.",
            options: ["A. r- r", "B. gi- d", "C. r- gi", "D. gi - gi"],
            answer: 2 
        },
        {
            id: 10, type: "multiple",
            // ‚úÖ ƒê√£ c·∫≠p nh·∫≠t ·∫£nh SVG v·ªõi ƒë√∫ng 4 d√≤ng ph√©p t√≠nh b·∫°n y√™u c·∫ßu
            imageText: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 350 280" width="100%" style="background-color: #1e392a; border-radius: 12px; border: 6px solid #bda88a; max-width: 400px; margin: 0 auto; display: block; box-shadow: inset 0 0 10px rgba(0,0,0,0.5);">
                <style>
                    .op { font-family: 'Nunito', sans-serif; font-size: 32px; fill: white; font-weight: bold; text-anchor: middle; dominant-baseline: middle; }
                    .res { font-family: 'Nunito', sans-serif; font-size: 32px; fill: white; font-weight: bold; dominant-baseline: middle; }
                    .shape { stroke-width: 4; fill: rgba(255,255,255,0.05); }
                    .circle { stroke: #FFb3ba; }
                    .square { stroke: #bae1ff; }
                    .triangle { stroke: #baffc9; }
                </style>
                <circle cx="80" cy="45" r="20" class="shape circle"/>
                <text x="140" y="50" class="op">+</text>
                <circle cx="200" cy="45" r="20" class="shape circle"/>
                <text x="250" y="50" class="op">=</text>
                <text x="280" y="50" class="res">14</text>
                
                <circle cx="80" cy="110" r="20" class="shape circle"/>
                <text x="140" y="115" class="op">+</text>
                <rect x="180" y="90" width="40" height="40" rx="4" class="shape square"/>
                <text x="250" y="115" class="op">=</text>
                <text x="280" y="115" class="res">10</text>
                
                <rect x="60" y="155" width="40" height="40" rx="4" class="shape square"/>
                <text x="140" y="180" class="op">+</text>
                <polygon points="200,150 176,195 224,195" stroke-linejoin="round" class="shape triangle"/>
                <text x="250" y="180" class="op">=</text>
                <text x="280" y="180" class="res">8</text>
                
                <polygon points="80,215 56,260 104,260" stroke-linejoin="round" class="shape triangle"/>
                <text x="140" y="245" class="op">+</text>
                <circle cx="200" cy="240" r="20" class="shape circle"/>
                <text x="250" y="245" class="op">=</text>
                <text x="280" y="245" class="res">12</text>
            </svg>`,
            text: "D·ª±a v√†o c√°c ph√©p t√≠nh tr√™n, h√¨nh tam gi√°c, h√¨nh vu√¥ng v√† h√¨nh tr√≤n c√≥ gi√° tr·ªã l√† bao nhi√™u?",
            options: [
                "A. Tam gi√°c: 5, H√¨nh vu√¥ng: 3, H√¨nh tr√≤n: 7", 
                "B. Tam gi√°c: 3, H√¨nh vu√¥ng: 5, H√¨nh tr√≤n: 7", 
                "C. Tam gi√°c: 7, H√¨nh vu√¥ng: 3, H√¨nh tr√≤n: 5", 
                "D. Tam gi√°c: 5, H√¨nh vu√¥ng: 7, H√¨nh tr√≤n: 3"
            ],
            answer: 0 
        },
        {
            id: 11, type: "multiple",
            imageText: "<img src='image/cau11.jpg' alt='·∫¢nh c√°c lo√†i hoa' style='max-width: 100%; height: auto;'>",
            text: "√î ch·ªØ tr√™n c√≥ .... t·ª´ ch·ªâ lo√†i hoa.",
            options: ["A. 1", "B. 2", "C. 3", "D. 4"],
            answer: 2 
        },
        {
            id: 12, type: "multiple",
            text: "C√¢u n√†o d∆∞·ªõi ƒë√¢y n√≥i v·ªÅ ƒë·ªì v·∫≠t?",
            options: [
                "A. B·ªë ƒëi l√†m ·ªü xa nh√†.",
                "B. Qu·∫£ na ·ªü ch·ª£ r·∫•t to v√† ng·ªçt.",
                "C. KhƒÉn len c·ªßa b√© m·ªÅm v√† ·∫•m.",
                "D. H√† m√£ l√† con v·∫≠t to l·ªõn."
            ],
            answer: 2
        },
        {
            id: 13, type: "multiple",
            imageText: "<img src='image/cau14.jpg' alt='·∫¢nh 4 b·∫°n h·ªçc sinh' style='max-width: 100%; height: auto;'>",
            text: "S·∫Øp x·∫øp t√™n c√°c b·∫°n sau theo ƒë√∫ng th·ª© t·ª± ch·ªØ c√°i trong b·∫£ng ch·ªØ c√°i.",
            options: [
                "A. Kh√°nh; D≈©ng; Mai; Chi",
                "B. Mai; Chi; Kh√°nh; D≈©ng",
                "C. Chi; D≈©ng; Mai; Kh√°nh"
            ],
            answer: 2
        },
        {
            id: 14, type: "multiple",
            text: "S·∫Øp x·∫øp c√°c ti·∫øng sau ƒë·ªÉ t·∫°o th√†nh c√¢u ho√†n ch·ªânh.<br>lƒÉng/ ch√πm / n·ªü/ bi·∫øc./ t√≠m / b·∫±ng / Nh·ªØng",
            options: [
                "A. Nh·ªØng ch√πm b·∫±ng lƒÉng t√≠m bi·∫øc n·ªü.", 
                "B. Nh·ªØng ch√πm b·∫±ng lƒÉng n·ªü t√≠m bi·∫øc.", 
                "C. Nh·ªØng b·∫±ng lƒÉng n·ªü ch√πm t√≠m bi·∫øc."
            ],
            answer: 1
        },
        {
            id: 15, type: "multiple",
            imageText: "<img src='image/cau16.jpg' alt='·∫¢nh ng∆∞·ªùi m·∫π ƒëang qu·∫°t' style='max-width: 100%; height: auto;'>",
            text: "H√¨nh ·∫£nh sau c√≥ th·ªÉ minh ho·∫° cho ƒëo·∫°n th∆° n√†o d∆∞·ªõi ƒë√¢y?",
            options: [
                "A. Nh·ªØng c√°nh ƒë·ªìng b√¨nh y√™n<br>N·∫±m ph∆°i m√¨nh ·ªü gi·ªØa<br>Nh·ªØng con s√¥ng xanh, h·ªìng<br>U·ªën quanh trƒÉm d·∫£i l·ª•a.",
                "B. Ch√∫ng em theo m·∫π<br>N√≥n l√° ra ƒë·ªìng<br>Ng√†n con su·ªëi nh·ªè<br>C√πng ch·∫£y v·ªÅ s√¥ng.",
                "C. L·ªùi ru c√≥ gi√≥ m√πa thu<br>B√†n tay m·∫π qu·∫°t m·∫π ƒë∆∞a gi√≥ v·ªÅ<br>Nh·ªØng ng√¥i sao th·ª©c ngo√†i kia<br>Ch·∫≥ng b·∫±ng m·∫π ƒë√£ th·ª©c v√¨ ch√∫ng con."
            ],
            answer: 2
        },
        {
            id: 16, type: "multiple",
            imageText: "<img src='image/cau18.jpg' alt='·∫¢nh b√© g√°i ƒÉn d∆∞a h·∫•u' style='max-width: 100%; height: auto;'>",
            text: "H√¨nh ·∫£nh sau th√≠ch h·ª£p m√¥ t·∫£ c√¢u t·ª•c ng·ªØ n√†o?",
            options: [
                "A. U·ªëng n∆∞·ªõc nh·ªõ ngu·ªìn.",
                "B. ƒÇn qu·∫£ nh·ªõ k·∫ª tr·ªìng c√¢y.",
                "C. ƒÇn tr√¥ng n·ªìi ng·ªìi tr√¥ng h∆∞·ªõng.",
                "D. H·ªçc ƒÉn, h·ªçc n√≥i, h·ªçc g√≥i, h·ªçc m·ªü."
            ],
            answer: 1
        },
        {
            id: 17, type: "multiple",
            imageText: "<img src='image/cau25.jpg' alt='Gh√©p v·∫ßn' style='max-width: 100%; height: auto;'>",
            text: "H√£y gh√©p h√¨nh ·∫£nh v·ªõi v·∫ßn t∆∞∆°ng ·ª©ng:",
            options: ["A. 1b 2c 3a", "B. 1c 2b 3a", "C. 1a 2c 3b"],
            answer: 2
        },
        {
            id: 18, type: "arrange",
            text: "S·∫Øp x·∫øp c√°c ch·ªØ sau ƒë·ªÉ t·∫°o th√†nh t·ª´ ch·ªâ ngh·ªÅ nghi·ªáp. (Nh·∫•n v√†o c√°c ch·ªØ c√°i b√™n d∆∞·ªõi ƒë·ªÉ gh√©p)",
            letters: ['i', 'P', 'h', 'c', 'g', '√¥', 'n'],
            correctAnswer: "Phic√¥ng",
            displayAnswer: "Phi c√¥ng"
        }
    ];

    const quizContainer = document.getElementById('quiz-container');

    function moveLetter(element, targetId, originId) {
        const parentId = element.parentElement.id;
        if (parentId === originId) {
            document.getElementById(targetId).appendChild(element);
        } else {
            document.getElementById(originId).appendChild(element);
        }
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function loadQuiz() {
        quizContainer.innerHTML = '';
        
        quizData.forEach((q, index) => {
            const questionElement = document.createElement('div');
            questionElement.className = 'question-card';
            
            let htmlContent = `<div class="question-title">C√¢u ${index + 1}: ${q.text}</div>`;
            
            if (q.imageText) {
                htmlContent += `<div class="image-placeholder">${q.imageText}</div>`; 
            }

            if (q.type === "multiple") {
                htmlContent += `<ul class="options-list">`;
                q.options.forEach((opt, optIndex) => {
                    htmlContent += `
                        <li class="option-item">
                            <label class="option-label" id="label-q${index}-o${optIndex}">
                                <input type="radio" name="question${index}" value="${optIndex}">
                                <span>${opt}</span>
                            </label>
                        </li>
                    `;
                });
                htmlContent += `</ul>`;
            } else if (q.type === "arrange") {
                htmlContent += `
                    <div class="arrange-container" id="arrange-container-${index}">
                        <span class="arrange-label">Khay ch·ªØ c√°i:</span>
                        <div class="letters-pool" id="pool-q${index}">
                `;
                let shuffledLetters = [...q.letters];
                shuffleArray(shuffledLetters);
                
                shuffledLetters.forEach((letter) => {
                    htmlContent += `<span class="letter-tile" onclick="moveLetter(this, 'answer-q${index}', 'pool-q${index}')">${letter}</span>`;
                });
                htmlContent += `
                        </div>
                        <span class="arrange-label">√î ƒë√°p √°n:</span>
                        <div class="answer-box" id="answer-q${index}"></div>
                        <div class="correct-text-msg" id="msg-q${index}">ƒê√°p √°n ƒë√∫ng: ${q.displayAnswer}</div>
                    </div>
                `;
            }

            questionElement.innerHTML = htmlContent;
            quizContainer.appendChild(questionElement);
        });

        document.getElementById('result-box').style.display = 'none';
        document.getElementById('resetBtn').style.display = 'none';
        document.getElementById('submitBtn').style.display = 'block';
    }

    function submitQuiz() {
        const studentNameInput = document.getElementById('studentName');
        const studentClassInput = document.getElementById('studentClass');
        const studentName = studentNameInput.value.trim();
        const studentClass = studentClassInput.value.trim();

        if (studentName === "" || studentClass === "") {
            alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß H·ªç v√† t√™n v√† L·ªõp tr∆∞·ªõc khi n·ªôp b√†i.");
            if(studentName === "") studentNameInput.focus();
            else studentClassInput.focus();
            document.querySelector('.student-info-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
            return; 
        }

        const btn = document.getElementById('submitBtn');
        btn.innerText = "ƒêang x·ª≠ l√Ω d·ªØ li·ªáu...";
        btn.classList.add('loading');

        let score = 0;
        
        quizData.forEach((q, index) => {
            if (q.type === "multiple") {
                const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                
                q.options.forEach((_, optIndex) => {
                    document.getElementById(`label-q${index}-o${optIndex}`).classList.remove('correct-answer', 'wrong-answer');
                });

                if (selectedOption) {
                    const selectedValue = parseInt(selectedOption.value);
                    document.getElementById(`label-q${index}-o${q.answer}`).classList.add('correct-answer');
                    if (selectedValue === q.answer) {
                        score++;
                    } else {
                        document.getElementById(`label-q${index}-o${selectedValue}`).classList.add('wrong-answer');
                    }
                } else {
                    document.getElementById(`label-q${index}-o${q.answer}`).classList.add('correct-answer');
                }
            } else if (q.type === "arrange") {
                const answerBox = document.getElementById(`answer-q${index}`);
                const userWord = Array.from(answerBox.children).map(span => span.innerText).join('');
                
                if (userWord.toLowerCase() === q.correctAnswer.toLowerCase()) {
                    score++;
                    answerBox.style.backgroundColor = '#DCFCE7';
                    answerBox.style.borderColor = '#22C55E';
                } else {
                    answerBox.style.backgroundColor = '#FEE2E2';
                    answerBox.style.borderColor = '#EF4444';
                    document.getElementById(`msg-q${index}`).style.display = 'block';
                }
            }
        });

        const storageKey = `quiz_attempts_${studentName.replace(/\s+/g, '')}_${studentClass.replace(/\s+/g, '')}`;
        let attempts = parseInt(localStorage.getItem(storageKey)) || 0;
        attempts += 1;
        localStorage.setItem(storageKey, attempts);

        let formData = new FormData();
        formData.append("name", studentName);
        formData.append("studentClass", studentClass);
        formData.append("score", score + "/" + quizData.length);
        formData.append("attempts", attempts);

        fetch(scriptURL, { method: 'POST', body: formData, mode: 'no-cors' })
            .then(response => {
                console.log('ƒê√£ g·ª≠i ƒëi·ªÉm th√†nh c√¥ng!');
                hienThiKetQua(studentName, studentClass, score, attempts, btn);
            })
            .catch(error => {
                console.error('L·ªói m·∫°ng, nh∆∞ng v·∫´n hi·ªán ƒëi·ªÉm:', error.message);
                hienThiKetQua(studentName, studentClass, score, attempts, btn); 
            });
    }

    function hienThiKetQua(studentName, studentClass, score, attempts, btn) {
        const resultBox = document.getElementById('result-box');
        resultBox.style.display = 'block';
        
        let feedbackIcon = score === quizData.length ? 'üå∑ Xu·∫•t s·∫Øc!' : 'üåª Ho√†n th√†nh!';
        
        resultBox.innerHTML = `
            <h2>${feedbackIcon}</h2>
            <div class="result-stats-container">
                <div class="result-stat">
                    <span>H·ªç v√† t√™n</span>
                    ${studentName}
                </div>
                <div class="result-stat">
                    <span>L·ªõp</span>
                    ${studentClass}
                </div>
                <div class="result-stat">
                    <span>K·∫øt qu·∫£</span>
                    <span class="score-highlight">${score} / ${quizData.length} c√¢u</span>
                </div>
                <div class="result-stat">
                    <span>S·ªë l·∫ßn n·ªôp</span>
                    ${attempts} l·∫ßn
                </div>
            </div>
            <p style="text-align: center; margin-top: 20px; font-size: 0.95em; color: var(--text-muted);">
                (C√°c c√¢u l√†m sai ƒë√£ ƒë∆∞·ª£c ƒë√°nh d·∫•u m√†u ƒë·ªè v√† hi·ªán ƒë√°p √°n ƒë√∫ng m√†u xanh r·ªìi ƒë√≥!)
            </p>
        `;
        
        btn.innerText = "N·ªôp B√†i & Ch·∫•m ƒêi·ªÉm";
        btn.classList.remove('loading');
        document.getElementById('submitBtn').style.display = 'none';
        document.getElementById('resetBtn').style.display = 'block';

        resultBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function resetQuiz() {
        shuffleArray(quizData);
        loadQuiz();
        document.querySelector('.student-info-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    window.onload = loadQuiz;
</script>

</body>
</html>