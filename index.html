<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p Tr·∫Øc Nghi·ªám Ti·∫øng Vi·ªát & To√°n</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --bg-color: #f4f7f6;
            --text-color: #333;
            --border-color: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 30px;
        }

        .student-info-card {
            background-color: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #c8e6c9;
        }

        .student-info-card h3 {
            margin-top: 0;
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box; 
        }

        #result-box {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background-color: #fff3cd; 
            border: 2px solid #ffeeba;
            border-radius: 8px;
            font-size: 1.1em;
            color: #856404;
        }

        #result-box h2 {
            margin-top: 0;
            text-align: center;
            color: #d39e00;
        }

        .result-stat {
            font-size: 1.2em;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
        }

        .question-card {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .question-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .poem-text {
            font-style: italic;
            background-color: #f9f9f9;
            padding: 10px;
            border-left: 3px solid #ccc;
            margin: 10px 0;
        }

        .image-placeholder {
            width: 100%;
            max-width: 500px;
            min-height: 150px;
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 15px;
            color: #6c757d;
            margin-bottom: 15px;
            border: 1px dashed #adb5bd;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .options-list {
            list-style-type: none;
            padding: 0;
        }

        .option-item {
            margin-bottom: 10px;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .option-label:hover {
            background-color: #e9ecef;
        }

        input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.2);
            cursor: pointer;
        }

        .arrange-container {
            margin-top: 10px;
        }
        
        .letters-pool, .answer-box {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
            min-height: 50px;
            border-radius: 8px;
            margin-bottom: 15px;
            align-items: center;
        }

        .letters-pool {
            background-color: #e3f2fd;
            border: 2px dashed #90caf9;
        }

        .answer-box {
            background-color: #fff9c4;
            border: 2px dashed #fff59d;
        }

        .letter-tile {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 45px;
            height: 45px;
            background-color: #fff;
            color: #1976d2;
            font-size: 1.5em;
            font-weight: bold;
            border: 2px solid #1976d2;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            user-select: none;
            transition: transform 0.1s;
        }

        .letter-tile:active {
            transform: scale(0.95);
        }

        .correct-text-msg {
            color: #155724;
            font-weight: bold;
            margin-top: 10px;
            display: none;
        }

        .correct-answer {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
            color: #155724;
            font-weight: bold;
        }

        .wrong-answer {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
            color: #721c24;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 20px;
            text-align: center;
        }

        .submit-btn {
            background-color: var(--primary-color);
        }

        .submit-btn:hover {
            background-color: #45a049;
        }

        .reset-btn {
            background-color: #2196F3;
            display: none; 
        }

        .reset-btn:hover {
            background-color: #1976D2;
        }
        
        /* Hi·ªáu ·ª©ng m·ªù khi ƒëang g·ª≠i ƒëi·ªÉm */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

    </style>
</head>
<body>

<div class="container">
    <h1>√în T·∫≠p Ki·∫øn Th·ª©c</h1>

    <div class="student-info-card">
        <h3>üìù Th√¥ng tin h·ªçc sinh</h3>
        <div class="input-group">
            <label for="studentName">H·ªç v√† t√™n c·ªßa em:</label>
            <input type="text" id="studentName" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A" required>
        </div>
        <div class="input-group">
            <label for="studentClass">L·ªõp:</label>
            <input type="text" id="studentClass" placeholder="V√≠ d·ª•: 1A1" required>
        </div>
    </div>

    <div id="quiz-container"></div>
    
    <button id="submitBtn" class="btn submit-btn" onclick="submitQuiz()">N·ªôp B√†i & Ch·∫•m ƒêi·ªÉm</button>
    <button id="resetBtn" class="btn reset-btn" onclick="resetQuiz()">üîÑ L√†m L·∫°i B√†i (ƒê·∫£o C√¢u H·ªèi)</button>
    
    <div id="result-box"></div>
</div>

<script>
    // ‚úÖ URL nh·∫≠n ƒëi·ªÉm Google Sheets c·ªßa b·∫°n
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxRA-yjp6i3c1FkUygNdWfGifXgLOV6UAPp3fB4MjjTZCvKLakwUcSJTrrrCWDpSgcD/exec'; 

    const quizData = [
        {
            id: 1, type: "multiple",
            text: "Nh·ªØng chi·∫øn sƒ© b·∫£o v·ªá t·ªï qu·ªëc c√≤n ƒë∆∞·ª£c g·ªçi l√† g√¨?",
            options: ["A. gi√°o vi√™n", "B. kƒ© s∆∞", "C. b·ªô ƒë·ªôi", "D. c·∫ßu th·ªß"],
            answer: 2
        },
        {
            id: 2, type: "multiple",
            text: "ƒê√°p √°n n√†o d∆∞·ªõi ƒë√¢y ch·ªâ g·ªìm c√°c t·ª´ ng·ªØ ch·ªâ trang ph·ª•c?",
            options: [
                "A. ƒë√¥i d√©p, th·∫Øt l∆∞ng, b√≥ hoa", 
                "B. qu·∫ßn v·∫£i, ƒë√¥i gi√†y, trang tr√≠", 
                "C. √°o kho√°c, m≈© len, khƒÉn qu√†ng", 
                "D. ƒë√¥i t·∫•t, gƒÉng tay, ph·ª•c v·ª•"
            ],
            answer: 2
        },
        {
            id: 3, type: "multiple",
            text: "Kh·ªï th∆° d∆∞·ªõi ƒë√¢y nh·∫Øc ƒë·∫øn d·∫•u thanh n√†o?<br><div class='poem-text'>D·∫•u n√†o c≈©ng n·ªïi tr√™n<br>Ri√™ng em th√¨ ch√¨m d∆∞·ªõi<br>M·ªçi ng∆∞·ªùi ƒë·ª´ng ch√™ em<br>Tuy nh·ªè nh∆∞ng n·∫∑ng k√≠.</div>(Nguy·ªÖn L√£m Th·∫Øng)",
            options: ["A. d·∫•u huy·ªÅn", "B. d·∫•u ng√£", "C. d·∫•u n·∫∑ng", "D. d·∫•u h·ªèi"],
            answer: 2
        },
        {
            id: 4, type: "multiple",
            text: "\"T√™ gi√°c\" c√≥ th·ªÉ gh√©p v·ªõi ƒë√°p √°n n√†o ƒë·ªÉ t·∫°o th√†nh c√¢u ƒë√∫ng?",
            options: [
                "A. nh·∫∑t th√≥c tr√™n s√¢n", 
                "B. s·ªëng trong khu r·ª´ng", 
                "C. ·∫•p tr·ª©ng trong t·ªï", 
                "D. m√≤ c√° tr√™n ƒë·ªìng"
            ],
            answer: 1
        },
        {
            id: 5, type: "multiple",
            imageText: "<img src='image/cau5.jpg' alt='H√¨nh ·∫£nh m·ªôt ch√∫ ong ƒëang h√∫t m·∫≠t t·ª´ hoa trong v∆∞·ªùn' style='max-width: 100%; height: auto;'>",
            text: "C√¢u n√†o m√¥ t·∫£ ƒë√∫ng h√¨nh ·∫£nh sau?",
            options: [
                "A. Nh·ªØng ch√∫ ong chƒÉm ch·ªâ t√¨m m·∫≠t trong v∆∞·ªùn.", 
                "B. Nh·ªØng ch√∫ b∆∞·ªõm ƒëang h√∫t m·∫≠t trong v∆∞·ªùn.", 
                "C. Nh·ªØng ch√∫ chim ƒëang ki·∫øm ƒÉn trong v∆∞·ªùn.", 
                "D. Nh·ªØng ch√∫ ong v√†ng ƒëang l√†m t·ªï trong v∆∞·ªùn."
            ],
            answer: 0
        },
        {
            id: 6, type: "multiple",
            text: "Ch·ªçn v·∫ßn th√≠ch h·ª£p ƒëi·ªÅn v√†o ch·ªó tr·ªëng.<br>C√°c t·ª´ ng·ªØ \"bi·∫øt ∆°n\", \"ti·∫øt h·ªçc\", \"th√¢n thi·∫øt\", \"vi·∫øt ch·ªØ\" c√≥ chung v·∫ßn .....",
            options: ["A. i√™n", "B. i√™t", "C. i√™c"],
            answer: 1
        },
        {
            id: 7, type: "multiple",
            text: "L·ªõp 1B c√≥ m·ªôt b·∫°n h·ªçc sinh m·ªõi chuy·ªÉn ƒë·∫øn. B·∫°n ·∫•y c√≥ v·∫ª nh√∫t nh√°t v√† ch∆∞a quen ai. C√¥ gi√°o nh·ªù l·ªõp tr∆∞·ªüng ra l√†m quen v·ªõi b·∫°n. B·∫°n l·ªõp tr∆∞·ªüng n√™n n√≥i g√¨?",
            options: [
                "A. Ch√†o c·∫≠u, t·ªõ l√† l·ªõp tr∆∞·ªüng. R·∫•t vui ƒë∆∞·ª£c l√†m quen v·ªõi c·∫≠u. C·∫≠u c√≥ c·∫ßn t·ªõ gi√∫p g√¨ kh√¥ng?", 
                "B. T·∫°i sao c·∫≠u l·∫°i chuy·ªÉn ƒë·∫øn tr∆∞·ªùng n√†y v·∫≠y?", 
                "C. Nh√¨n c·∫≠u c√≥ v·∫ª √≠t n√≥i nh·ªâ.", 
                "D. C·∫≠u c√≥ bi·∫øt l√†m b√†i t·∫≠p to√°n h√¥m qua kh√¥ng?"
            ],
            answer: 0
        },
        {
            id: 8, type: "multiple",
            imageText: "<img src='image/cau8.jpg' alt='H√¨nh ·∫£nh c√°c con v·∫≠t: Th·ªè, G·∫•u tr√∫c, M√®o, S√≥c, Tr√¢u, H·ªï, Chu·ªôt, Corgi' style='max-width: 100%; height: auto;'>",
            text: "Trong h√¨nh ·∫£nh tr√™n c√≥ ...... con v·∫≠t c√≥ t√™n ch·ª©a v·∫ßn \"√¢u\"?",
            options: ["A. 1", "B. 2", "C. 3", "D. 4"],
            answer: 1
        },
        {
            id: 9, type: "multiple",
            text: "Ch·ªçn ch·ªØ th√≠ch h·ª£p l·∫ßn l∆∞·ª£t ƒëi·ªÅn v√†o ch·ªó tr·ªëng sau:<br>Th·ªùi ti·∫øt m√πa ƒë√¥ng [...]·∫•t l·∫°nh [...]√°.",
            options: ["A. r- r", "B. gi- d", "C. r- gi", "D. gi - gi"],
            answer: 2 
        },
        {
            id: 10, type: "multiple",
            imageText: "<img src='image/cau10.jpg' alt='·∫¢nh To√°n t∆∞ duy: C√°c ph√©p t√≠nh v·ªõi H√¨nh tr√≤n, H√¨nh vu√¥ng, H√¨nh tam gi√°c' style='max-width: 100%; height: auto;'>",
            text: "D·ª±a v√†o c√°c ph√©p t√≠nh tr√™n, h√¨nh tam gi√°c, h√¨nh vu√¥ng v√† h√¨nh tr√≤n c√≥ gi√° tr·ªã l√† bao nhi√™u?",
            options: [
                "A. Tam gi√°c: 5, H√¨nh vu√¥ng: 3, H√¨nh tr√≤n: 7", 
                "B. Tam gi√°c: 3, H√¨nh vu√¥ng: 5, H√¨nh tr√≤n: 7", 
                "C. Tam gi√°c: 7, H√¨nh vu√¥ng: 3, H√¨nh tr√≤n: 5", 
                "D. Tam gi√°c: 5, H√¨nh vu√¥ng: 7, H√¨nh tr√≤n: 3"
            ],
            answer: 0 
        },
        {
            id: 11, type: "multiple",
            imageText: "<img src='image/cau11.jpg' alt='·∫¢nh c√°c lo√†i hoa' style='max-width: 100%; height: auto;'>",
            text: "√î ch·ªØ tr√™n c√≥ .... t·ª´ ch·ªâ lo√†i hoa.",
            options: ["A. 1", "B. 2", "C. 3", "D. 4"],
            answer: 2 
        },
        {
            id: 12, type: "multiple",
            text: "C√¢u n√†o d∆∞·ªõi ƒë√¢y n√≥i v·ªÅ ƒë·ªì v·∫≠t?",
            options: [
                "A. B·ªë ƒëi l√†m ·ªü xa nh√†.",
                "B. Qu·∫£ na ·ªü ch·ª£ r·∫•t to v√† ng·ªçt.",
                "C. KhƒÉn len c·ªßa b√© m·ªÅm v√† ·∫•m.",
                "D. H√† m√£ l√† con v·∫≠t to l·ªõn."
            ],
            answer: 2
        },
        {
            id: 13, type: "multiple",
            imageText: "<img src='image/cau14.jpg' alt='·∫¢nh 4 b·∫°n h·ªçc sinh' style='max-width: 100%; height: auto;'>",
            text: "S·∫Øp x·∫øp t√™n c√°c b·∫°n sau theo ƒë√∫ng th·ª© t·ª± ch·ªØ c√°i trong b·∫£ng ch·ªØ c√°i.",
            options: [
                "A. Kh√°nh; D≈©ng; Mai; Chi",
                "B. Mai; Chi; Kh√°nh; D≈©ng",
                "C. Chi; D≈©ng; Mai; Kh√°nh"
            ],
            answer: 2
        },
        {
            id: 14, type: "multiple",
            text: "S·∫Øp x·∫øp c√°c ti·∫øng sau ƒë·ªÉ t·∫°o th√†nh c√¢u ho√†n ch·ªânh.<br>lƒÉng/ ch√πm / n·ªü/ bi·∫øc./ t√≠m / b·∫±ng / Nh·ªØng",
            options: [
                "A. Nh·ªØng ch√πm b·∫±ng lƒÉng t√≠m bi·∫øc n·ªü.", 
                "B. Nh·ªØng ch√πm b·∫±ng lƒÉng n·ªü t√≠m bi·∫øc.", 
                "C. Nh·ªØng b·∫±ng lƒÉng n·ªü ch√πm t√≠m bi·∫øc."
            ],
            answer: 1
        },
        {
            id: 15, type: "multiple",
            imageText: "<img src='image/cau16.jpg' alt='·∫¢nh ng∆∞·ªùi m·∫π ƒëang qu·∫°t' style='max-width: 100%; height: auto;'>",
            text: "H√¨nh ·∫£nh sau c√≥ th·ªÉ minh ho·∫° cho ƒëo·∫°n th∆° n√†o d∆∞·ªõi ƒë√¢y?",
            options: [
                "A. Nh·ªØng c√°nh ƒë·ªìng b√¨nh y√™n<br>N·∫±m ph∆°i m√¨nh ·ªü gi·ªØa<br>Nh·ªØng con s√¥ng xanh, h·ªìng<br>U·ªën quanh trƒÉm d·∫£i l·ª•a.",
                "B. Ch√∫ng em theo m·∫π<br>N√≥n l√° ra ƒë·ªìng<br>Ng√†n con su·ªëi nh·ªè<br>C√πng ch·∫£y v·ªÅ s√¥ng.",
                "C. L·ªùi ru c√≥ gi√≥ m√πa thu<br>B√†n tay m·∫π qu·∫°t m·∫π ƒë∆∞a gi√≥ v·ªÅ<br>Nh·ªØng ng√¥i sao th·ª©c ngo√†i kia<br>Ch·∫≥ng b·∫±ng m·∫π ƒë√£ th·ª©c v√¨ ch√∫ng con."
            ],
            answer: 2
        },
        {
            id: 16, type: "multiple",
            imageText: "<img src='image/cau18.jpg' alt='·∫¢nh b√© g√°i ƒÉn d∆∞a h·∫•u' style='max-width: 100%; height: auto;'>",
            text: "H√¨nh ·∫£nh sau th√≠ch h·ª£p m√¥ t·∫£ c√¢u t·ª•c ng·ªØ n√†o?",
            options: [
                "A. U·ªëng n∆∞·ªõc nh·ªõ ngu·ªìn.",
                "B. ƒÇn qu·∫£ nh·ªõ k·∫ª tr·ªìng c√¢y.",
                "C. ƒÇn tr√¥ng n·ªìi ng·ªìi tr√¥ng h∆∞·ªõng.",
                "D. H·ªçc ƒÉn, h·ªçc n√≥i, h·ªçc g√≥i, h·ªçc m·ªü."
            ],
            answer: 1
        },
        {
            id: 17, type: "multiple",
            imageText: "<img src='image/cau25.jpg' alt='Gh√©p v·∫ßn' style='max-width: 100%; height: auto;'>",
            text: "H√£y gh√©p h√¨nh ·∫£nh v·ªõi v·∫ßn t∆∞∆°ng ·ª©ng:",
            options: ["A. 1b 2c 3a", "B. 1c 2b 3a", "C. 1a 2c 3b"],
            answer: 2
        },
        {
            id: 18, type: "arrange",
            text: "S·∫Øp x·∫øp c√°c ch·ªØ sau ƒë·ªÉ t·∫°o th√†nh t·ª´ ch·ªâ ngh·ªÅ nghi·ªáp. (Nh·∫•n v√†o c√°c ch·ªØ c√°i b√™n d∆∞·ªõi ƒë·ªÉ gh√©p)",
            letters: ['i', 'P', 'h', 'c', 'g', '√¥', 'n'],
            correctAnswer: "Phic√¥ng",
            displayAnswer: "Phi c√¥ng"
        }
    ];

    const quizContainer = document.getElementById('quiz-container');

    function moveLetter(element, targetId, originId) {
        const parentId = element.parentElement.id;
        if (parentId === originId) {
            document.getElementById(targetId).appendChild(element);
        } else {
            document.getElementById(originId).appendChild(element);
        }
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function loadQuiz() {
        quizContainer.innerHTML = '';
        
        quizData.forEach((q, index) => {
            const questionElement = document.createElement('div');
            questionElement.className = 'question-card';
            
            let htmlContent = `<div class="question-title">C√¢u ${index + 1}: ${q.text}</div>`;
            
            if (q.imageText) {
                htmlContent += `<div class="image-placeholder">${q.imageText}</div>`; 
            }

            if (q.type === "multiple") {
                htmlContent += `<ul class="options-list">`;
                q.options.forEach((opt, optIndex) => {
                    htmlContent += `
                        <li class="option-item">
                            <label class="option-label" id="label-q${index}-o${optIndex}">
                                <input type="radio" name="question${index}" value="${optIndex}">
                                ${opt}
                            </label>
                        </li>
                    `;
                });
                htmlContent += `</ul>`;
            } else if (q.type === "arrange") {
                htmlContent += `
                    <div class="arrange-container" id="arrange-container-${index}">
                        <div style="font-size: 0.9em; color: #666;">Khay ch·ªØ c√°i:</div>
                        <div class="letters-pool" id="pool-q${index}">
                `;
                let shuffledLetters = [...q.letters];
                shuffleArray(shuffledLetters);
                
                shuffledLetters.forEach((letter) => {
                    htmlContent += `<span class="letter-tile" onclick="moveLetter(this, 'answer-q${index}', 'pool-q${index}')">${letter}</span>`;
                });
                htmlContent += `
                        </div>
                        <div style="font-size: 0.9em; color: #666;">√î ƒë√°p √°n c·ªßa b·∫°n:</div>
                        <div class="answer-box" id="answer-q${index}"></div>
                        <div class="correct-text-msg" id="msg-q${index}">ƒê√°p √°n ƒë√∫ng l√†: ${q.displayAnswer}</div>
                    </div>
                `;
            }

            questionElement.innerHTML = htmlContent;
            quizContainer.appendChild(questionElement);
        });

        document.getElementById('result-box').style.display = 'none';
        document.getElementById('resetBtn').style.display = 'none';
        document.getElementById('submitBtn').style.display = 'block';
    }

    function submitQuiz() {
        const studentNameInput = document.getElementById('studentName');
        const studentClassInput = document.getElementById('studentClass');
        const studentName = studentNameInput.value.trim();
        const studentClass = studentClassInput.value.trim();

        if (studentName === "" || studentClass === "") {
            alert("Em vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß H·ªç v√† t√™n v√† L·ªõp tr∆∞·ªõc khi n·ªôp b√†i nh√©!");
            if(studentName === "") studentNameInput.focus();
            else studentClassInput.focus();
            document.querySelector('.student-info-card').scrollIntoView({ behavior: 'smooth' });
            return; 
        }

        const btn = document.getElementById('submitBtn');
        btn.innerText = "ƒêang ch·∫•m b√†i v√† g·ª≠i ƒëi·ªÉm...";
        btn.classList.add('loading');

        let score = 0;
        
        quizData.forEach((q, index) => {
            if (q.type === "multiple") {
                const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                
                q.options.forEach((_, optIndex) => {
                    document.getElementById(`label-q${index}-o${optIndex}`).classList.remove('correct-answer', 'wrong-answer');
                });

                if (selectedOption) {
                    const selectedValue = parseInt(selectedOption.value);
                    document.getElementById(`label-q${index}-o${q.answer}`).classList.add('correct-answer');
                    if (selectedValue === q.answer) {
                        score++;
                    } else {
                        document.getElementById(`label-q${index}-o${selectedValue}`).classList.add('wrong-answer');
                    }
                } else {
                    document.getElementById(`label-q${index}-o${q.answer}`).classList.add('correct-answer');
                }
            } else if (q.type === "arrange") {
                const answerBox = document.getElementById(`answer-q${index}`);
                const userWord = Array.from(answerBox.children).map(span => span.innerText).join('');
                
                if (userWord.toLowerCase() === q.correctAnswer.toLowerCase()) {
                    score++;
                    answerBox.style.backgroundColor = '#d4edda';
                    answerBox.style.borderColor = '#c3e6cb';
                } else {
                    answerBox.style.backgroundColor = '#f8d7da';
                    answerBox.style.borderColor = '#f5c6cb';
                    document.getElementById(`msg-q${index}`).style.display = 'block';
                }
            }
        });

        const storageKey = `quiz_attempts_${studentName.replace(/\s+/g, '')}_${studentClass.replace(/\s+/g, '')}`;
        let attempts = parseInt(localStorage.getItem(storageKey)) || 0;
        attempts += 1;
        localStorage.setItem(storageKey, attempts);

        // --- G·ª¨I D·ªÆ LI·ªÜU L√äN GOOGLE SHEETS ---
        let formData = new FormData();
        formData.append("name", studentName);
        formData.append("studentClass", studentClass);
        formData.append("score", score + "/" + quizData.length);
        formData.append("attempts", attempts);

        // ‚úÖ G·ª≠i fetch v·ªõi no-cors v√† x·ª≠ l√Ω giao di·ªán ngay l·∫≠p t·ª©c
        fetch(scriptURL, { method: 'POST', body: formData, mode: 'no-cors' })
            .then(response => {
                console.log('ƒê√£ g·ª≠i ƒëi·ªÉm th√†nh c√¥ng l√™n Google Sheets!');
                hienThiKetQua(studentName, studentClass, score, attempts, btn);
            })
            .catch(error => {
                console.error('L·ªói khi g·ª≠i ƒëi·ªÉm!', error.message);
                hienThiKetQua(studentName, studentClass, score, attempts, btn); // V·∫´n hi·ªán k·∫øt qu·∫£ n·∫øu l·ª° r·ªõt m·∫°ng
            });
    }

    // T√°ch ph·∫ßn hi·ªÉn th·ªã k·∫øt qu·∫£ ra th√†nh h√†m ri√™ng ƒë·ªÉ ch·∫°y sau khi fetch xong
    function hienThiKetQua(studentName, studentClass, score, attempts, btn) {
        const resultBox = document.getElementById('result-box');
        resultBox.style.display = 'block';
        resultBox.innerHTML = `
            <h2>Ho√†n Th√†nh B√†i T·∫≠p!</h2>
            <div class="result-stat">üë§ <strong>H·ªç v√† t√™n:</strong> ${studentName}</div>
            <div class="result-stat">üè´ <strong>L·ªõp:</strong> ${studentClass}</div>
            <div class="result-stat">üéØ <strong>S·ªë c√¢u ƒë√∫ng:</strong> ${score} / ${quizData.length} c√¢u</div>
            <div class="result-stat">üîÑ <strong>S·ªë l·∫ßn n·ªôp b√†i:</strong> ${attempts} l·∫ßn</div>
            <p style="text-align: center; margin-top: 20px; font-size: 0.9em;">
                <em>(C√°c c√¢u sai ƒë√£ ƒë∆∞·ª£c b√¥i ƒë·ªè v√† hi·ªÉn th·ªã ƒë√°p √°n ƒë√∫ng m√†u xanh ·ªü ph√≠a tr√™n)</em>
            </p>
        `;
        
        btn.innerText = "N·ªôp B√†i & Ch·∫•m ƒêi·ªÉm";
        btn.classList.remove('loading');
        document.getElementById('submitBtn').style.display = 'none';
        document.getElementById('resetBtn').style.display = 'block';

        resultBox.scrollIntoView({ behavior: 'smooth' });
    }

    function resetQuiz() {
        shuffleArray(quizData);
        loadQuiz();
        document.querySelector('.student-info-card').scrollIntoView({ behavior: 'smooth' });
    }

    window.onload = loadQuiz;
</script>

</body>
</html>